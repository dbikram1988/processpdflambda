'use strict';function cov_1ifrg41uvu(){var path="C:\\JavaSafariTranining\\clm-poc\\doc-management-lambda\\processPDF\\app.js";var hash="b1083ba243aaeadbe35844f0918e93fd1f9b34ec";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\JavaSafariTranining\\clm-poc\\doc-management-lambda\\processPDF\\app.js",statementMap:{"0":{start:{line:3,column:12},end:{line:3,column:30}},"1":{start:{line:4,column:0},end:{line:4,column:42}},"2":{start:{line:6,column:12},end:{line:6,column:32}},"3":{start:{line:13,column:0},end:{line:27,column:1}},"4":{start:{line:15,column:2},end:{line:15,column:45}},"5":{start:{line:18,column:2},end:{line:26,column:3}},"6":{start:{line:20,column:5},end:{line:24,column:6}},"7":{start:{line:21,column:7},end:{line:21,column:35}},"8":{start:{line:23,column:7},end:{line:23,column:45}},"9":{start:{line:30,column:24},end:{line:77,column:1}},"10":{start:{line:31,column:13},end:{line:31,column:25}},"11":{start:{line:34,column:17},end:{line:34,column:37}},"12":{start:{line:35,column:14},end:{line:35,column:73}},"13":{start:{line:37,column:2},end:{line:37,column:47}},"14":{start:{line:40,column:17},end:{line:43,column:14}},"15":{start:{line:44,column:2},end:{line:44,column:22}},"16":{start:{line:47,column:19},end:{line:47,column:65}},"17":{start:{line:48,column:2},end:{line:48,column:24}},"18":{start:{line:49,column:19},end:{line:49,column:36}},"19":{start:{line:52,column:2},end:{line:53,column:17}},"20":{start:{line:53,column:4},end:{line:53,column:17}},"21":{start:{line:56,column:4},end:{line:56,column:29}},"22":{start:{line:60,column:2},end:{line:76,column:3}},"23":{start:{line:62,column:17},end:{line:62,column:39}},"24":{start:{line:63,column:4},end:{line:63,column:54}},"25":{start:{line:66,column:4},end:{line:72,column:17}},"26":{start:{line:75,column:4},end:{line:75,column:42}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:18},end:{line:13,column:19}},loc:{start:{line:13,column:35},end:{line:27,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:21},end:{line:19,column:22}},loc:{start:{line:19,column:38},end:{line:25,column:4}},line:19},"2":{name:"(anonymous_2)",decl:{start:{line:30,column:24},end:{line:30,column:25}},loc:{start:{line:30,column:41},end:{line:77,column:1}},line:30}},branchMap:{"0":{loc:{start:{line:52,column:2},end:{line:53,column:17}},type:"if",locations:[{start:{line:52,column:2},end:{line:53,column:17}},{start:{line:52,column:2},end:{line:53,column:17}}],line:52},"1":{loc:{start:{line:52,column:5},end:{line:52,column:46}},type:"binary-expr",locations:[{start:{line:52,column:5},end:{line:52,column:21}},{start:{line:52,column:25},end:{line:52,column:46}}],line:52}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b1083ba243aaeadbe35844f0918e93fd1f9b34ec"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1ifrg41uvu=function(){return actualCoverage;};}return actualCoverage;}cov_1ifrg41uvu();const AWS=(cov_1ifrg41uvu().s[0]++,require('aws-sdk'));cov_1ifrg41uvu().s[1]++;AWS.config.region=process.env.AWS_REGION;const pdf=(cov_1ifrg41uvu().s[2]++,require('pdf-parse'));// Invoked when a PDF is put into the source
// bucket. Extracts text content and saves into
// staging bucket (OutputBucket).
// The standard Lambda handler
cov_1ifrg41uvu().s[3]++;exports.handler=async event=>{cov_1ifrg41uvu().f[0]++;cov_1ifrg41uvu().s[4]++;console.log(JSON.stringify(event,null,2));// Handle each incoming S3 object in the event
cov_1ifrg41uvu().s[5]++;await Promise.all(event.Records.map(async event=>{cov_1ifrg41uvu().f[1]++;cov_1ifrg41uvu().s[6]++;try{cov_1ifrg41uvu().s[7]++;await processDocument(event);}catch(err){cov_1ifrg41uvu().s[8]++;console.error(`Handler error: ${err}`);}}));};// The standard Lambda handler
cov_1ifrg41uvu().s[9]++;const processDocument=async event=>{cov_1ifrg41uvu().f[2]++;const s3=(cov_1ifrg41uvu().s[10]++,new AWS.S3());// Get object info
const Bucket=(cov_1ifrg41uvu().s[11]++,event.s3.bucket.name);const Key=(cov_1ifrg41uvu().s[12]++,decodeURIComponent(event.s3.object.key.replace(/\+/g,' ')));cov_1ifrg41uvu().s[13]++;console.log(`Bucket: ${Bucket}, Key: ${Key}`);// Get content from source S3 object
const result=(cov_1ifrg41uvu().s[14]++,await s3.getObject({Bucket,Key}).promise());cov_1ifrg41uvu().s[15]++;console.log(result);// Get meta data from S3 object
const metaData=(cov_1ifrg41uvu().s[16]++,await s3.headObject({Bucket,Key}).promise());cov_1ifrg41uvu().s[17]++;console.log(metaData);const Metadata=(cov_1ifrg41uvu().s[18]++,metaData.Metadata);// If any meta data present in the uploaded s3 object then pass it to next process
cov_1ifrg41uvu().s[19]++;if((cov_1ifrg41uvu().b[1][0]++,Metadata==null)||(cov_1ifrg41uvu().b[1][1]++,Metadata==undefined)){cov_1ifrg41uvu().b[0][0]++;cov_1ifrg41uvu().s[20]++;Metadata={};}else{cov_1ifrg41uvu().b[0][1]++;}// Adding an additional metadata for object url
cov_1ifrg41uvu().s[21]++;Metadata['doc_key']=Key;cov_1ifrg41uvu().s[22]++;try{// Extract text from PDF
const data=(cov_1ifrg41uvu().s[23]++,await pdf(result.Body));cov_1ifrg41uvu().s[24]++;console.log('PDF text length: ',data.text.length);// Write result to staging S3 bucket
cov_1ifrg41uvu().s[25]++;await s3.putObject({Bucket:process.env.OutputBucket,Key:`pdf/${Key}.txt`,Body:data.text,ContentType:'application/text',Metadata:Metadata}).promise();}catch(err){cov_1ifrg41uvu().s[26]++;console.error(`Handler error: ${err}`);}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJBV1MiLCJyZXF1aXJlIiwiY29uZmlnIiwicmVnaW9uIiwicHJvY2VzcyIsImVudiIsIkFXU19SRUdJT04iLCJwZGYiLCJleHBvcnRzIiwiaGFuZGxlciIsImV2ZW50IiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJQcm9taXNlIiwiYWxsIiwiUmVjb3JkcyIsIm1hcCIsInByb2Nlc3NEb2N1bWVudCIsImVyciIsImVycm9yIiwiczMiLCJTMyIsIkJ1Y2tldCIsImJ1Y2tldCIsIm5hbWUiLCJLZXkiLCJkZWNvZGVVUklDb21wb25lbnQiLCJvYmplY3QiLCJrZXkiLCJyZXBsYWNlIiwicmVzdWx0IiwiZ2V0T2JqZWN0IiwicHJvbWlzZSIsIm1ldGFEYXRhIiwiaGVhZE9iamVjdCIsIk1ldGFkYXRhIiwidW5kZWZpbmVkIiwiZGF0YSIsIkJvZHkiLCJ0ZXh0IiwibGVuZ3RoIiwicHV0T2JqZWN0IiwiT3V0cHV0QnVja2V0IiwiQ29udGVudFR5cGUiXSwibWFwcGluZ3MiOiJBQUFBLGEsMm5HQWVZOzJGQWJaLEtBQU1BLENBQUFBLEdBQUcsMEJBQUdDLE9BQU8sQ0FBQyxTQUFELENBQVYsQ0FBVCxDLHdCQUNBRCxHQUFHLENBQUNFLE1BQUosQ0FBV0MsTUFBWCxDQUFvQkMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBQWhDLENBRUEsS0FBTUMsQ0FBQUEsR0FBRywwQkFBR04sT0FBTyxDQUFDLFdBQUQsQ0FBVixDQUFULENBRUE7QUFDQTtBQUNBO0FBRUE7d0JBQ0FPLE9BQU8sQ0FBQ0MsT0FBUixDQUFrQixLQUFPQyxDQUFBQSxLQUFQLEVBQWlCLGlEQUVqQ0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDLElBQUksQ0FBQ0MsU0FBTCxDQUFlSixLQUFmLENBQXNCLElBQXRCLENBQTRCLENBQTVCLENBQVosRUFFQTtBQUppQyx3QkFLakMsS0FBTUssQ0FBQUEsT0FBTyxDQUFDQyxHQUFSLENBQ0xOLEtBQUssQ0FBQ08sT0FBTixDQUFjQyxHQUFkLENBQWtCLEtBQU9SLENBQUFBLEtBQVAsRUFBaUIsaURBQ2pDLEdBQUkseUJBQ0YsS0FBTVMsQ0FBQUEsZUFBZSxDQUFDVCxLQUFELENBQXJCLENBQ0QsQ0FBQyxNQUFPVSxHQUFQLENBQVkseUJBQ1pULE9BQU8sQ0FBQ1UsS0FBUixDQUFlLGtCQUFpQkQsR0FBSSxFQUFwQyxFQUNELENBQ0YsQ0FORCxDQURLLENBQU4sQ0FTRCxDQWRELENBZ0JBO3dCQUNBLEtBQU1ELENBQUFBLGVBQWUsQ0FBRyxLQUFPVCxDQUFBQSxLQUFQLEVBQWlCLHlCQUN2QyxLQUFNWSxDQUFBQSxFQUFFLDJCQUFHLEdBQUl0QixDQUFBQSxHQUFHLENBQUN1QixFQUFSLEVBQUgsQ0FBUixDQUVBO0FBQ0EsS0FBTUMsQ0FBQUEsTUFBTSwyQkFBR2QsS0FBSyxDQUFDWSxFQUFOLENBQVNHLE1BQVQsQ0FBZ0JDLElBQW5CLENBQVosQ0FDQSxLQUFNQyxDQUFBQSxHQUFHLDJCQUFHQyxrQkFBa0IsQ0FBQ2xCLEtBQUssQ0FBQ1ksRUFBTixDQUFTTyxNQUFULENBQWdCQyxHQUFoQixDQUFvQkMsT0FBcEIsQ0FBNEIsS0FBNUIsQ0FBbUMsR0FBbkMsQ0FBRCxDQUFyQixDQUFULENBTHVDLHlCQU92Q3BCLE9BQU8sQ0FBQ0MsR0FBUixDQUFhLFdBQVVZLE1BQU8sVUFBU0csR0FBSSxFQUEzQyxFQUVBO0FBQ0EsS0FBTUssQ0FBQUEsTUFBTSwyQkFBRyxLQUFNVixDQUFBQSxFQUFFLENBQUNXLFNBQUgsQ0FBYSxDQUNoQ1QsTUFEZ0MsQ0FFaENHLEdBRmdDLENBQWIsRUFHbEJPLE9BSGtCLEVBQVQsQ0FBWixDQVZ1Qyx5QkFjdkN2QixPQUFPLENBQUNDLEdBQVIsQ0FBWW9CLE1BQVosRUFFQTtBQUNBLEtBQU1HLENBQUFBLFFBQVEsMkJBQUcsS0FBTWIsQ0FBQUEsRUFBRSxDQUFDYyxVQUFILENBQWMsQ0FBRVosTUFBRixDQUFVRyxHQUFWLENBQWQsRUFBK0JPLE9BQS9CLEVBQVQsQ0FBZCxDQWpCdUMseUJBa0J2Q3ZCLE9BQU8sQ0FBQ0MsR0FBUixDQUFZdUIsUUFBWixFQUNBLEtBQU1FLENBQUFBLFFBQVEsMkJBQUdGLFFBQVEsQ0FBQ0UsUUFBWixDQUFkLENBRUE7QUFyQnVDLHlCQXNCdkMsR0FBRyw0QkFBQUEsUUFBUSxFQUFJLElBQVosK0JBQW9CQSxRQUFRLEVBQUlDLFNBQWhDLENBQUgsQ0FDRSxxREFBQUQsUUFBUSxDQUFHLEVBQVgsQ0FBYSxDQURmLGlDQUdFO0FBekJxQyx5QkEwQnJDQSxRQUFRLENBQUMsU0FBRCxDQUFSLENBQXNCVixHQUF0QixDQTFCcUMseUJBOEJ2QyxHQUFJLENBQ0Y7QUFDQSxLQUFNWSxDQUFBQSxJQUFJLDJCQUFHLEtBQU1oQyxDQUFBQSxHQUFHLENBQUN5QixNQUFNLENBQUNRLElBQVIsQ0FBWixDQUFWLENBRkUseUJBR0Y3QixPQUFPLENBQUNDLEdBQVIsQ0FBWSxtQkFBWixDQUFpQzJCLElBQUksQ0FBQ0UsSUFBTCxDQUFVQyxNQUEzQyxFQUVBO0FBTEUseUJBTUYsS0FBTXBCLENBQUFBLEVBQUUsQ0FBQ3FCLFNBQUgsQ0FBYSxDQUNqQm5CLE1BQU0sQ0FBRXBCLE9BQU8sQ0FBQ0MsR0FBUixDQUFZdUMsWUFESCxDQUVqQmpCLEdBQUcsQ0FBRyxPQUFNQSxHQUFJLE1BRkMsQ0FHakJhLElBQUksQ0FBRUQsSUFBSSxDQUFDRSxJQUhNLENBSWpCSSxXQUFXLENBQUUsa0JBSkksQ0FLakJSLFFBQVEsQ0FBRUEsUUFMTyxDQUFiLEVBTUhILE9BTkcsRUFBTixDQVFELENBQUMsTUFBT2QsR0FBUCxDQUFZLDBCQUNaVCxPQUFPLENBQUNVLEtBQVIsQ0FBZSxrQkFBaUJELEdBQUksRUFBcEMsRUFDRCxDQUNGLENBL0NEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXHJcblxyXG5jb25zdCBBV1MgPSByZXF1aXJlKCdhd3Mtc2RrJylcclxuQVdTLmNvbmZpZy5yZWdpb24gPSBwcm9jZXNzLmVudi5BV1NfUkVHSU9OIFxyXG5cclxuY29uc3QgcGRmID0gcmVxdWlyZSgncGRmLXBhcnNlJylcclxuXHJcbi8vIEludm9rZWQgd2hlbiBhIFBERiBpcyBwdXQgaW50byB0aGUgc291cmNlXHJcbi8vIGJ1Y2tldC4gRXh0cmFjdHMgdGV4dCBjb250ZW50IGFuZCBzYXZlcyBpbnRvXHJcbi8vIHN0YWdpbmcgYnVja2V0IChPdXRwdXRCdWNrZXQpLlxyXG5cclxuLy8gVGhlIHN0YW5kYXJkIExhbWJkYSBoYW5kbGVyXHJcbmV4cG9ydHMuaGFuZGxlciA9IGFzeW5jIChldmVudCkgPT4ge1xyXG5cclxuICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShldmVudCwgbnVsbCwgMikpXHJcblxyXG4gIC8vIEhhbmRsZSBlYWNoIGluY29taW5nIFMzIG9iamVjdCBpbiB0aGUgZXZlbnRcclxuICBhd2FpdCBQcm9taXNlLmFsbChcclxuICAgZXZlbnQuUmVjb3Jkcy5tYXAoYXN5bmMgKGV2ZW50KSA9PiB7XHJcbiAgICAgdHJ5IHtcclxuICAgICAgIGF3YWl0IHByb2Nlc3NEb2N1bWVudChldmVudClcclxuICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgIGNvbnNvbGUuZXJyb3IoYEhhbmRsZXIgZXJyb3I6ICR7ZXJyfWApXHJcbiAgICAgfVxyXG4gICB9KVxyXG4gIClcclxufVxyXG5cclxuLy8gVGhlIHN0YW5kYXJkIExhbWJkYSBoYW5kbGVyXHJcbmNvbnN0IHByb2Nlc3NEb2N1bWVudCA9IGFzeW5jIChldmVudCkgPT4ge1xyXG4gIGNvbnN0IHMzID0gbmV3IEFXUy5TMygpXHJcblxyXG4gIC8vIEdldCBvYmplY3QgaW5mb1xyXG4gIGNvbnN0IEJ1Y2tldCA9IGV2ZW50LnMzLmJ1Y2tldC5uYW1lXHJcbiAgY29uc3QgS2V5ID0gZGVjb2RlVVJJQ29tcG9uZW50KGV2ZW50LnMzLm9iamVjdC5rZXkucmVwbGFjZSgvXFwrL2csICcgJykpXHJcbiAgXHJcbiAgY29uc29sZS5sb2coYEJ1Y2tldDogJHtCdWNrZXR9LCBLZXk6ICR7S2V5fWApXHJcblxyXG4gIC8vIEdldCBjb250ZW50IGZyb20gc291cmNlIFMzIG9iamVjdFxyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHMzLmdldE9iamVjdCh7XHJcbiAgICBCdWNrZXQsXHJcbiAgICBLZXlcclxuICB9KS5wcm9taXNlKClcclxuICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG5cclxuICAvLyBHZXQgbWV0YSBkYXRhIGZyb20gUzMgb2JqZWN0XHJcbiAgY29uc3QgbWV0YURhdGEgPSBhd2FpdCBzMy5oZWFkT2JqZWN0KHsgQnVja2V0LCBLZXkgfSkucHJvbWlzZSgpO1xyXG4gIGNvbnNvbGUubG9nKG1ldGFEYXRhKTtcclxuICBjb25zdCBNZXRhZGF0YSA9IG1ldGFEYXRhLk1ldGFkYXRhXHJcblxyXG4gIC8vIElmIGFueSBtZXRhIGRhdGEgcHJlc2VudCBpbiB0aGUgdXBsb2FkZWQgczMgb2JqZWN0IHRoZW4gcGFzcyBpdCB0byBuZXh0IHByb2Nlc3NcclxuICBpZihNZXRhZGF0YSA9PSBudWxsIHx8IE1ldGFkYXRhID09IHVuZGVmaW5lZClcclxuICAgIE1ldGFkYXRhID0ge31cclxuXHJcbiAgICAvLyBBZGRpbmcgYW4gYWRkaXRpb25hbCBtZXRhZGF0YSBmb3Igb2JqZWN0IHVybFxyXG4gICAgTWV0YWRhdGFbJ2RvY19rZXknXSA9IEtleVxyXG5cclxuXHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBFeHRyYWN0IHRleHQgZnJvbSBQREZcclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBwZGYocmVzdWx0LkJvZHkpXHJcbiAgICBjb25zb2xlLmxvZygnUERGIHRleHQgbGVuZ3RoOiAnLCBkYXRhLnRleHQubGVuZ3RoKVxyXG5cclxuICAgIC8vIFdyaXRlIHJlc3VsdCB0byBzdGFnaW5nIFMzIGJ1Y2tldFxyXG4gICAgYXdhaXQgczMucHV0T2JqZWN0KHtcclxuICAgICAgQnVja2V0OiBwcm9jZXNzLmVudi5PdXRwdXRCdWNrZXQsXHJcbiAgICAgIEtleTogYHBkZi8ke0tleX0udHh0YCxcclxuICAgICAgQm9keTogZGF0YS50ZXh0LFxyXG4gICAgICBDb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3RleHQnLFxyXG4gICAgICBNZXRhZGF0YTogTWV0YWRhdGFcclxuICAgIH0pLnByb21pc2UoKTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKGBIYW5kbGVyIGVycm9yOiAke2Vycn1gKVxyXG4gIH1cclxufVxyXG4iXX0=