'use strict';function cov_1ifrg41uvu(){var path="C:\\JavaSafariTranining\\clm-poc\\doc-management-lambda\\processPDF\\app.js";var hash="b1083ba243aaeadbe35844f0918e93fd1f9b34ec";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\JavaSafariTranining\\clm-poc\\doc-management-lambda\\processPDF\\app.js",statementMap:{"0":{start:{line:3,column:12},end:{line:3,column:30}},"1":{start:{line:4,column:0},end:{line:4,column:42}},"2":{start:{line:6,column:12},end:{line:6,column:32}},"3":{start:{line:13,column:0},end:{line:27,column:1}},"4":{start:{line:15,column:2},end:{line:15,column:45}},"5":{start:{line:18,column:2},end:{line:26,column:3}},"6":{start:{line:20,column:5},end:{line:24,column:6}},"7":{start:{line:21,column:7},end:{line:21,column:35}},"8":{start:{line:23,column:7},end:{line:23,column:45}},"9":{start:{line:30,column:24},end:{line:77,column:1}},"10":{start:{line:31,column:13},end:{line:31,column:25}},"11":{start:{line:34,column:17},end:{line:34,column:37}},"12":{start:{line:35,column:14},end:{line:35,column:73}},"13":{start:{line:37,column:2},end:{line:37,column:47}},"14":{start:{line:40,column:17},end:{line:43,column:14}},"15":{start:{line:44,column:2},end:{line:44,column:22}},"16":{start:{line:47,column:19},end:{line:47,column:65}},"17":{start:{line:48,column:2},end:{line:48,column:24}},"18":{start:{line:49,column:19},end:{line:49,column:36}},"19":{start:{line:52,column:2},end:{line:53,column:17}},"20":{start:{line:53,column:4},end:{line:53,column:17}},"21":{start:{line:56,column:4},end:{line:56,column:29}},"22":{start:{line:60,column:2},end:{line:76,column:3}},"23":{start:{line:62,column:17},end:{line:62,column:39}},"24":{start:{line:63,column:4},end:{line:63,column:54}},"25":{start:{line:66,column:4},end:{line:72,column:17}},"26":{start:{line:75,column:4},end:{line:75,column:42}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:18},end:{line:13,column:19}},loc:{start:{line:13,column:35},end:{line:27,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:21},end:{line:19,column:22}},loc:{start:{line:19,column:38},end:{line:25,column:4}},line:19},"2":{name:"(anonymous_2)",decl:{start:{line:30,column:24},end:{line:30,column:25}},loc:{start:{line:30,column:41},end:{line:77,column:1}},line:30}},branchMap:{"0":{loc:{start:{line:52,column:2},end:{line:53,column:17}},type:"if",locations:[{start:{line:52,column:2},end:{line:53,column:17}},{start:{line:52,column:2},end:{line:53,column:17}}],line:52},"1":{loc:{start:{line:52,column:5},end:{line:52,column:46}},type:"binary-expr",locations:[{start:{line:52,column:5},end:{line:52,column:21}},{start:{line:52,column:25},end:{line:52,column:46}}],line:52}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b1083ba243aaeadbe35844f0918e93fd1f9b34ec"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1ifrg41uvu=function(){return actualCoverage;};}return actualCoverage;}cov_1ifrg41uvu();const AWS=(cov_1ifrg41uvu().s[0]++,require('aws-sdk'));cov_1ifrg41uvu().s[1]++;AWS.config.region=process.env.AWS_REGION;const pdf=(cov_1ifrg41uvu().s[2]++,require('pdf-parse'));// Invoked when a PDF is put into the source
// bucket. Extracts text content and saves into
// staging bucket (OutputBucket).
// The standard Lambda handler
cov_1ifrg41uvu().s[3]++;exports.handler=async event=>{cov_1ifrg41uvu().f[0]++;cov_1ifrg41uvu().s[4]++;console.log(JSON.stringify(event,null,2));// Handle each incoming S3 object in the event
cov_1ifrg41uvu().s[5]++;await Promise.all(event.Records.map(async event=>{cov_1ifrg41uvu().f[1]++;cov_1ifrg41uvu().s[6]++;try{cov_1ifrg41uvu().s[7]++;await processDocument(event);}catch(err){cov_1ifrg41uvu().s[8]++;console.error(`Handler error: ${err}`);}}));};// The standard Lambda handler
cov_1ifrg41uvu().s[9]++;const processDocument=async event=>{cov_1ifrg41uvu().f[2]++;const s3=(cov_1ifrg41uvu().s[10]++,new AWS.S3());// Get object info
const Bucket=(cov_1ifrg41uvu().s[11]++,event.s3.bucket.name);const Key=(cov_1ifrg41uvu().s[12]++,decodeURIComponent(event.s3.object.key.replace(/\+/g,' ')));cov_1ifrg41uvu().s[13]++;console.log(`Bucket: ${Bucket}, Key: ${Key}`);// Get content from source S3 object
const result=(cov_1ifrg41uvu().s[14]++,await s3.getObject({Bucket,Key}).promise());cov_1ifrg41uvu().s[15]++;console.log(result);// Get meta data from S3 object
const metaData=(cov_1ifrg41uvu().s[16]++,await s3.headObject({Bucket,Key}).promise());cov_1ifrg41uvu().s[17]++;console.log(metaData);const Metadata=(cov_1ifrg41uvu().s[18]++,metaData.Metadata);// If any meta data present in the uploaded s3 object then pass it to next process
cov_1ifrg41uvu().s[19]++;if((cov_1ifrg41uvu().b[1][0]++,Metadata==null)||(cov_1ifrg41uvu().b[1][1]++,Metadata==undefined)){cov_1ifrg41uvu().b[0][0]++;cov_1ifrg41uvu().s[20]++;Metadata={};}else{cov_1ifrg41uvu().b[0][1]++;}// Adding an additional metadata for object url
cov_1ifrg41uvu().s[21]++;Metadata['doc_key']=Key;cov_1ifrg41uvu().s[22]++;try{// Extract text from PDF
const data=(cov_1ifrg41uvu().s[23]++,await pdf(result.Body));cov_1ifrg41uvu().s[24]++;console.log('PDF text length: ',data.text.length);// Write result to staging S3 bucket
cov_1ifrg41uvu().s[25]++;console.log(await s3.putObject({Bucket:process.env.OutputBucket,Key:`pdf/${Key}.txt`,Body:data.text,ContentType:'application/text',Metadata:Metadata}).promise());}catch(err){cov_1ifrg41uvu().s[26]++;console.error(`Handler error: ${err}`);}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJBV1MiLCJyZXF1aXJlIiwiY29uZmlnIiwicmVnaW9uIiwicHJvY2VzcyIsImVudiIsIkFXU19SRUdJT04iLCJwZGYiLCJleHBvcnRzIiwiaGFuZGxlciIsImV2ZW50IiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJQcm9taXNlIiwiYWxsIiwiUmVjb3JkcyIsIm1hcCIsInByb2Nlc3NEb2N1bWVudCIsImVyciIsImVycm9yIiwiczMiLCJTMyIsIkJ1Y2tldCIsImJ1Y2tldCIsIm5hbWUiLCJLZXkiLCJkZWNvZGVVUklDb21wb25lbnQiLCJvYmplY3QiLCJrZXkiLCJyZXBsYWNlIiwicmVzdWx0IiwiZ2V0T2JqZWN0IiwicHJvbWlzZSIsIm1ldGFEYXRhIiwiaGVhZE9iamVjdCIsIk1ldGFkYXRhIiwidW5kZWZpbmVkIiwiZGF0YSIsIkJvZHkiLCJ0ZXh0IiwibGVuZ3RoIiwicHV0T2JqZWN0IiwiT3V0cHV0QnVja2V0IiwiQ29udGVudFR5cGUiXSwibWFwcGluZ3MiOiJBQUFBLGEsMm5HQWVZOzJGQWJaLEtBQU1BLENBQUFBLEdBQUcsMEJBQUdDLE9BQU8sQ0FBQyxTQUFELENBQVYsQ0FBVCxDLHdCQUNBRCxHQUFHLENBQUNFLE1BQUosQ0FBV0MsTUFBWCxDQUFvQkMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBQWhDLENBRUEsS0FBTUMsQ0FBQUEsR0FBRywwQkFBR04sT0FBTyxDQUFDLFdBQUQsQ0FBVixDQUFULENBRUE7QUFDQTtBQUNBO0FBRUE7d0JBQ0FPLE9BQU8sQ0FBQ0MsT0FBUixDQUFrQixLQUFPQyxDQUFBQSxLQUFQLEVBQWlCLGlEQUVqQ0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDLElBQUksQ0FBQ0MsU0FBTCxDQUFlSixLQUFmLENBQXNCLElBQXRCLENBQTRCLENBQTVCLENBQVosRUFFQTtBQUppQyx3QkFLakMsS0FBTUssQ0FBQUEsT0FBTyxDQUFDQyxHQUFSLENBQ0xOLEtBQUssQ0FBQ08sT0FBTixDQUFjQyxHQUFkLENBQWtCLEtBQU9SLENBQUFBLEtBQVAsRUFBaUIsaURBQ2pDLEdBQUkseUJBQ0YsS0FBTVMsQ0FBQUEsZUFBZSxDQUFDVCxLQUFELENBQXJCLENBQ0QsQ0FBQyxNQUFPVSxHQUFQLENBQVkseUJBQ1pULE9BQU8sQ0FBQ1UsS0FBUixDQUFlLGtCQUFpQkQsR0FBSSxFQUFwQyxFQUNELENBQ0YsQ0FORCxDQURLLENBQU4sQ0FTRCxDQWRELENBZ0JBO3dCQUNBLEtBQU1ELENBQUFBLGVBQWUsQ0FBRyxLQUFPVCxDQUFBQSxLQUFQLEVBQWlCLHlCQUN2QyxLQUFNWSxDQUFBQSxFQUFFLDJCQUFHLEdBQUl0QixDQUFBQSxHQUFHLENBQUN1QixFQUFSLEVBQUgsQ0FBUixDQUVBO0FBQ0EsS0FBTUMsQ0FBQUEsTUFBTSwyQkFBR2QsS0FBSyxDQUFDWSxFQUFOLENBQVNHLE1BQVQsQ0FBZ0JDLElBQW5CLENBQVosQ0FDQSxLQUFNQyxDQUFBQSxHQUFHLDJCQUFHQyxrQkFBa0IsQ0FBQ2xCLEtBQUssQ0FBQ1ksRUFBTixDQUFTTyxNQUFULENBQWdCQyxHQUFoQixDQUFvQkMsT0FBcEIsQ0FBNEIsS0FBNUIsQ0FBbUMsR0FBbkMsQ0FBRCxDQUFyQixDQUFULENBTHVDLHlCQU92Q3BCLE9BQU8sQ0FBQ0MsR0FBUixDQUFhLFdBQVVZLE1BQU8sVUFBU0csR0FBSSxFQUEzQyxFQUVBO0FBQ0EsS0FBTUssQ0FBQUEsTUFBTSwyQkFBRyxLQUFNVixDQUFBQSxFQUFFLENBQUNXLFNBQUgsQ0FBYSxDQUNoQ1QsTUFEZ0MsQ0FFaENHLEdBRmdDLENBQWIsRUFHbEJPLE9BSGtCLEVBQVQsQ0FBWixDQVZ1Qyx5QkFjdkN2QixPQUFPLENBQUNDLEdBQVIsQ0FBWW9CLE1BQVosRUFFQTtBQUNBLEtBQU1HLENBQUFBLFFBQVEsMkJBQUcsS0FBTWIsQ0FBQUEsRUFBRSxDQUFDYyxVQUFILENBQWMsQ0FBRVosTUFBRixDQUFVRyxHQUFWLENBQWQsRUFBK0JPLE9BQS9CLEVBQVQsQ0FBZCxDQWpCdUMseUJBa0J2Q3ZCLE9BQU8sQ0FBQ0MsR0FBUixDQUFZdUIsUUFBWixFQUNBLEtBQU1FLENBQUFBLFFBQVEsMkJBQUdGLFFBQVEsQ0FBQ0UsUUFBWixDQUFkLENBRUE7QUFyQnVDLHlCQXNCdkMsR0FBRyw0QkFBQUEsUUFBUSxFQUFJLElBQVosK0JBQW9CQSxRQUFRLEVBQUlDLFNBQWhDLENBQUgsQ0FDRSxxREFBQUQsUUFBUSxDQUFHLEVBQVgsQ0FBYSxDQURmLGlDQUdFO0FBekJxQyx5QkEwQnJDQSxRQUFRLENBQUMsU0FBRCxDQUFSLENBQXNCVixHQUF0QixDQTFCcUMseUJBOEJ2QyxHQUFJLENBQ0Y7QUFDQSxLQUFNWSxDQUFBQSxJQUFJLDJCQUFHLEtBQU1oQyxDQUFBQSxHQUFHLENBQUN5QixNQUFNLENBQUNRLElBQVIsQ0FBWixDQUFWLENBRkUseUJBR0Y3QixPQUFPLENBQUNDLEdBQVIsQ0FBWSxtQkFBWixDQUFpQzJCLElBQUksQ0FBQ0UsSUFBTCxDQUFVQyxNQUEzQyxFQUVBO0FBTEUseUJBTUYvQixPQUFPLENBQUNDLEdBQVIsQ0FBWSxLQUFNVSxDQUFBQSxFQUFFLENBQUNxQixTQUFILENBQWEsQ0FDN0JuQixNQUFNLENBQUVwQixPQUFPLENBQUNDLEdBQVIsQ0FBWXVDLFlBRFMsQ0FFN0JqQixHQUFHLENBQUcsT0FBTUEsR0FBSSxNQUZhLENBRzdCYSxJQUFJLENBQUVELElBQUksQ0FBQ0UsSUFIa0IsQ0FJN0JJLFdBQVcsQ0FBRSxrQkFKZ0IsQ0FLN0JSLFFBQVEsQ0FBRUEsUUFMbUIsQ0FBYixFQU1mSCxPQU5lLEVBQWxCLEVBUUQsQ0FBQyxNQUFPZCxHQUFQLENBQVksMEJBQ1pULE9BQU8sQ0FBQ1UsS0FBUixDQUFlLGtCQUFpQkQsR0FBSSxFQUFwQyxFQUNELENBQ0YsQ0EvQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcclxuXHJcbmNvbnN0IEFXUyA9IHJlcXVpcmUoJ2F3cy1zZGsnKVxyXG5BV1MuY29uZmlnLnJlZ2lvbiA9IHByb2Nlc3MuZW52LkFXU19SRUdJT04gXHJcblxyXG5jb25zdCBwZGYgPSByZXF1aXJlKCdwZGYtcGFyc2UnKVxyXG5cclxuLy8gSW52b2tlZCB3aGVuIGEgUERGIGlzIHB1dCBpbnRvIHRoZSBzb3VyY2VcclxuLy8gYnVja2V0LiBFeHRyYWN0cyB0ZXh0IGNvbnRlbnQgYW5kIHNhdmVzIGludG9cclxuLy8gc3RhZ2luZyBidWNrZXQgKE91dHB1dEJ1Y2tldCkuXHJcblxyXG4vLyBUaGUgc3RhbmRhcmQgTGFtYmRhIGhhbmRsZXJcclxuZXhwb3J0cy5oYW5kbGVyID0gYXN5bmMgKGV2ZW50KSA9PiB7XHJcblxyXG4gIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGV2ZW50LCBudWxsLCAyKSlcclxuXHJcbiAgLy8gSGFuZGxlIGVhY2ggaW5jb21pbmcgUzMgb2JqZWN0IGluIHRoZSBldmVudFxyXG4gIGF3YWl0IFByb21pc2UuYWxsKFxyXG4gICBldmVudC5SZWNvcmRzLm1hcChhc3luYyAoZXZlbnQpID0+IHtcclxuICAgICB0cnkge1xyXG4gICAgICAgYXdhaXQgcHJvY2Vzc0RvY3VtZW50KGV2ZW50KVxyXG4gICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgY29uc29sZS5lcnJvcihgSGFuZGxlciBlcnJvcjogJHtlcnJ9YClcclxuICAgICB9XHJcbiAgIH0pXHJcbiAgKVxyXG59XHJcblxyXG4vLyBUaGUgc3RhbmRhcmQgTGFtYmRhIGhhbmRsZXJcclxuY29uc3QgcHJvY2Vzc0RvY3VtZW50ID0gYXN5bmMgKGV2ZW50KSA9PiB7XHJcbiAgY29uc3QgczMgPSBuZXcgQVdTLlMzKClcclxuXHJcbiAgLy8gR2V0IG9iamVjdCBpbmZvXHJcbiAgY29uc3QgQnVja2V0ID0gZXZlbnQuczMuYnVja2V0Lm5hbWVcclxuICBjb25zdCBLZXkgPSBkZWNvZGVVUklDb21wb25lbnQoZXZlbnQuczMub2JqZWN0LmtleS5yZXBsYWNlKC9cXCsvZywgJyAnKSlcclxuICBcclxuICBjb25zb2xlLmxvZyhgQnVja2V0OiAke0J1Y2tldH0sIEtleTogJHtLZXl9YClcclxuXHJcbiAgLy8gR2V0IGNvbnRlbnQgZnJvbSBzb3VyY2UgUzMgb2JqZWN0XHJcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgczMuZ2V0T2JqZWN0KHtcclxuICAgIEJ1Y2tldCxcclxuICAgIEtleVxyXG4gIH0pLnByb21pc2UoKVxyXG4gIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcblxyXG4gIC8vIEdldCBtZXRhIGRhdGEgZnJvbSBTMyBvYmplY3RcclxuICBjb25zdCBtZXRhRGF0YSA9IGF3YWl0IHMzLmhlYWRPYmplY3QoeyBCdWNrZXQsIEtleSB9KS5wcm9taXNlKCk7XHJcbiAgY29uc29sZS5sb2cobWV0YURhdGEpO1xyXG4gIGNvbnN0IE1ldGFkYXRhID0gbWV0YURhdGEuTWV0YWRhdGFcclxuXHJcbiAgLy8gSWYgYW55IG1ldGEgZGF0YSBwcmVzZW50IGluIHRoZSB1cGxvYWRlZCBzMyBvYmplY3QgdGhlbiBwYXNzIGl0IHRvIG5leHQgcHJvY2Vzc1xyXG4gIGlmKE1ldGFkYXRhID09IG51bGwgfHwgTWV0YWRhdGEgPT0gdW5kZWZpbmVkKVxyXG4gICAgTWV0YWRhdGEgPSB7fVxyXG5cclxuICAgIC8vIEFkZGluZyBhbiBhZGRpdGlvbmFsIG1ldGFkYXRhIGZvciBvYmplY3QgdXJsXHJcbiAgICBNZXRhZGF0YVsnZG9jX2tleSddID0gS2V5XHJcblxyXG5cclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIEV4dHJhY3QgdGV4dCBmcm9tIFBERlxyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHBkZihyZXN1bHQuQm9keSlcclxuICAgIGNvbnNvbGUubG9nKCdQREYgdGV4dCBsZW5ndGg6ICcsIGRhdGEudGV4dC5sZW5ndGgpXHJcblxyXG4gICAgLy8gV3JpdGUgcmVzdWx0IHRvIHN0YWdpbmcgUzMgYnVja2V0XHJcbiAgICBjb25zb2xlLmxvZyhhd2FpdCBzMy5wdXRPYmplY3Qoe1xyXG4gICAgICBCdWNrZXQ6IHByb2Nlc3MuZW52Lk91dHB1dEJ1Y2tldCxcclxuICAgICAgS2V5OiBgcGRmLyR7S2V5fS50eHRgLFxyXG4gICAgICBCb2R5OiBkYXRhLnRleHQsXHJcbiAgICAgIENvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vdGV4dCcsXHJcbiAgICAgIE1ldGFkYXRhOiBNZXRhZGF0YVxyXG4gICAgfSkucHJvbWlzZSgpKVxyXG5cclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoYEhhbmRsZXIgZXJyb3I6ICR7ZXJyfWApXHJcbiAgfVxyXG59XHJcbiJdfQ==